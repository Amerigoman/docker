{% extends 'base.html' %}
{% load waffle_tags %}
{% load i18n %}

{% block title %} Active sprint {% endblock %}

{% block breadcrumbs %}
  {{ block.super }}
  <li>
    <a href="{% url 'project:list' %}">Projects</a>
  </li>
  <li>
    <a href="{% url 'project:detail' project.id %}">{{ project.title }}</a>
  </li>
  <li>
    <span>{% trans 'Active sprint' %}</span>
  </li>
{% endblock %}

{% block content %}
  {% flag 'create_sprint' %}
      <a href="{% url 'project:sprint_create' project.id %}"
       class="btn btn-primary pull-right">Create new sprint</a>
  {% endflag %}
  {% include 'project/project_navbar.html' with sprint_detail=True %}


  {% if no_active_sprint %}

    <div class="page-header"><h1>There is no active sprint yet</h1></div>
  {% endif %}

  {% if not no_active_sprint %}
    <div class="table-responsive">
      <table class="table table-bordered">
        <thead>
        <tr>
          <th>Sprint Title</th>
          <th>Start date</th>
          <th>End date</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>{{ active_sprint.title }}</td>
          <td>{{ active_sprint.start_date|date:"d/m/Y" }}</td>
          <td>{{ active_sprint.end_date|date:"d/m/Y" }}</td>
        </tr>
        </tbody>
      </table>
    </div>
    <br><br>

    <div class="text-center table-responsive">
      <p><strong>Dashboard</strong></p>
      <div class="col-md-4">
        <table class="table table-striped table-bordered">
          <thead>
          <tr>
            <th class="text-center">New issues</th>
          </tr>
          </thead>
          <tbody>
          {% for new_iss in new_issues %}
            <tr>
              <td>
                <a class="align-middle" href="
{% url 'project:issue_detail' new_iss.project_id new_iss.id %}">
                  {{ new_iss.title }}</a>
                {% flag "push_issue" %}
                  <form style="float: right"
                        action="{% url 'project:issue_push' new_iss.project_id new_iss.id %}"
                        method="post">
                    {% csrf_token %}
                    <button type="submit" name="right"><span
                        class="glyphicon glyphicon-circle-arrow-right team-event"></span>
                    </button>
                  </form>
                {% endflag %}
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="col-md-4">
        <table class="table table-striped table-bordered">
          <thead>
          <tr>
            <th class="text-center">Issues in progress</th>
          </tr>
          </thead>
          <tbody>
          {% for progress in in_progress_issues %}
            <tr>
              <td>
                {% flag "push_issue" %}
                  <form style="float: left"
                        action="{% url 'project:issue_push' progress.project_id progress.id %}"
                        method="post">
                    {% csrf_token %}
                    <button type="submit" name="left"><span
                        class="glyphicon glyphicon-circle-arrow-left"></span>
                    </button>
                  </form>
                {% endflag %}
                <a class="align-middle" href="
{% url 'project:issue_detail' progress.project_id progress.id %}">
                  {{ progress.title }}</a>
                {% flag "push_issue" %}
                  <form style="float: right"
                        action="{% url 'project:issue_push' progress.project_id progress.id %}"
                        method="post">
                    {% csrf_token %}
                    <button type="submit" name="right"><span
                        class="glyphicon glyphicon-circle-arrow-right"></span>
                    </button>
                  </form>
                {% endflag %}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="col-md-4">
        <table class="table table-striped table-bordered">
          <thead>
          <tr>
            <th class="text-center">Resolved issues</th>
          </tr>
          </thead>
          <tbody>
          {% for resolved in resolved_issues %}
            <tr>
              <td>
                {% flag "push_issue" %}
                  <form style="float: left"
                        action="{% url 'project:issue_push' resolved.project_id resolved.id %}"
                        method="post">
                    {% csrf_token %}
                    <button type="submit" name="left"><span
                        class="glyphicon glyphicon-circle-arrow-left"></span>
                    </button>
                  </form>
                {% endflag %}
                <a class="align-middle" href="
{% url 'project:issue_detail' resolved.project_id resolved.id %}">
                  {{ resolved.title }}</a></td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}
{% endblock %}
